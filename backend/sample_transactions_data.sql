-- Create transactions table if it doesn't exist
CREATE TABLE IF NOT EXISTS tabar_transactions (
    id SERIAL PRIMARY KEY,
    tabar_id INTEGER REFERENCES tabarim(id),
    transaction_type VARCHAR(50) NOT NULL, -- חשבונית, תשלום, זיכוי, העברה
    supplier_name VARCHAR(255),
    supplier_id VARCHAR(50),
    order_number VARCHAR(100),
    amount DECIMAL(15,2) NOT NULL,
    direction VARCHAR(20) NOT NULL, -- חיוב, זיכוי, כניסה
    status VARCHAR(50) NOT NULL, -- שולם, לא שולם, בתהליך, מופסק
    transaction_date DATE NOT NULL,
    description TEXT,
    reported BOOLEAN DEFAULT FALSE,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);

-- Insert sample transactions data
INSERT INTO tabar_transactions (tabar_id, transaction_type, supplier_name, supplier_id, order_number, amount, direction, status, transaction_date, description, reported) VALUES
-- Transactions for תב"ר 2211
(1, 'חשבונית', 'חברת הבנייה המובילה בע"מ', '515123456', 'INV-2024-001', 125000.00, 'חיוב', 'שולם', '2024-01-15', 'עבודות בנייה - שלב א', true),
(1, 'חשבונית', 'ספקי ציוד חשמל בע"מ', '515789012', 'INV-2024-002', 45000.00, 'חיוב', 'לא שולם', '2024-01-20', 'התקנת מערכות חשמל', false),
(1, 'תשלום', 'חברת הבנייה המובילה בע"מ', '515123456', 'PAY-2024-001', 125000.00, 'זיכוי', 'שולם', '2024-01-25', 'תשלום עבור חשבונית INV-2024-001', true),
(1, 'חשבונית', 'קבלני גמר בע"מ', '515345678', 'INV-2024-003', 78000.00, 'חיוב', 'בתהליך', '2024-02-01', 'עבודות גמר ושיפוץ', false),

-- Transactions for תב"ר 1205 (חינוך)
(2, 'חשבונית', 'ספקי ציוד לימודי בע"מ', '515456789', 'EDU-2024-001', 35000.00, 'חיוב', 'שולם', '2024-01-10', 'ספרי לימוד ומחשבים', true),
(2, 'חשבונית', 'חברת תחזוקה חינוכית', '515567890', 'EDU-2024-002', 18500.00, 'חיוב', 'שולם', '2024-01-25', 'תחזוקת מבני בית ספר', true),
(2, 'תשלום', 'ספקי ציוד לימודי בע"מ', '515456789', 'PAY-EDU-001', 35000.00, 'זיכוי', 'שולם', '2024-01-15', 'תשלום עבור ציוד לימודי', true),
(2, 'חשבונית', 'מערכות מחשוב חינוכי', '515678901', 'EDU-2024-003', 67000.00, 'חיוב', 'לא שולם', '2024-02-10', 'מערכת ניהול דיגיטלית', false),

-- Transactions for תב"ר 3401 (בריאות)
(3, 'חשבונית', 'ציוד רפואי מתקדם בע"מ', '515789123', 'MED-2024-001', 180000.00, 'חיוב', 'שולם', '2024-01-05', 'מכשור רפואי חדש', true),
(3, 'חשבונית', 'חברת תחזוקת מכשור רפואי', '515890234', 'MED-2024-002', 25000.00, 'חיוב', 'בתהליך', '2024-01-30', 'תחזוקה שנתית למכשור', false),
(3, 'תשלום', 'ציוד רפואי מתקדם בע"מ', '515789123', 'PAY-MED-001', 180000.00, 'זיכוי', 'שולם', '2024-01-12', 'תשלום עבור ציוד רפואי', true),

-- Transactions for תב"ר 4502 (תחבורה)
(4, 'חשבונית', 'חברת כבישים ותשתיות', '515901345', 'ROAD-2024-001', 450000.00, 'חיוב', 'לא שולם', '2024-02-01', 'סלילת כבישים חדשים', false),
(4, 'חשבונית', 'ספקי תמרור ושילוט', '515012456', 'ROAD-2024-002', 85000.00, 'חיוב', 'שולם', '2024-01-28', 'התקנת תמרורים ושילוט', true),
(4, 'תשלום', 'ספקי תמרור ושילוט', '515012456', 'PAY-ROAD-001', 85000.00, 'זיכוי', 'שולם', '2024-02-03', 'תשלום עבור שילוט', true),

-- Transactions for תב"ר 5601 (תרבות)
(5, 'חשבונית', 'ציוד תרבותי ואמנות', '515123567', 'CUL-2024-001', 32000.00, 'חיוב', 'שולם', '2024-01-12', 'ציוד לאירועי תרבות', true),
(5, 'חשבונית', 'הפקת אירועים תרבותיים', '515234678', 'CUL-2024-002', 75000.00, 'חיוב', 'לא שולם', '2024-02-05', 'הפקת פסטיבל תרבות', false),
(5, 'תשלום', 'ציוד תרבותי ואמנות', '515123567', 'PAY-CUL-001', 32000.00, 'זיכוי', 'שולם', '2024-01-18', 'תשלום עבור ציוד תרבותי', true),

-- Additional unpaid invoices for testing
(1, 'חשבונית', 'חומרי בנייה מתקדמים', '515987654', 'INV-2024-010', 95000.00, 'חיוב', 'לא שולם', '2024-02-15', 'חומרי גמר מיוחדים', false),
(2, 'חשבונית', 'ספקי טכנולוגיה חינוכית', '515876543', 'EDU-2024-010', 42000.00, 'חיוב', 'לא שולם', '2024-02-12', 'לוחות אינטראקטיביים', false),
(3, 'חשבונית', 'תרופות ואביזרים רפואיים', '515765432', 'MED-2024-010', 38000.00, 'חיוב', 'לא שולם', '2024-02-08', 'מלאי תרופות חירום', false),

-- Some unreported transactions
(4, 'חשבונית', 'חברת תחזוקת כבישים', '515654321', 'ROAD-2024-010', 28000.00, 'חיוב', 'שולם', '2024-02-10', 'תיקוני כבישים חורף', false),
(5, 'חשבונית', 'ספקי קישוטים ותפאורה', '515543210', 'CUL-2024-010', 15000.00, 'חיוב', 'שולם', '2024-02-14', 'קישוטים לאירוע חג', false);

-- Update timestamps
UPDATE tabar_transactions SET updated_at = CURRENT_TIMESTAMP; 