# מדריך שימוש במודלים החדשים
## העלאת מסמכים ודיווחי ביצוע

### 🎯 סקירה כללית
המערכת כוללת שני מודלים חדשים לניהול פרויקטים:
1. **מודל העלאת מסמכים** - להעלאת מסמכים תומכים לפרויקט
2. **מודל דיווח ביצוע** - לדיווח על ביצוע תקציבי עם מסמכים תומכים

---

## 📄 מודל העלאת מסמכים

### מיקום הכפתור
- **דף פרטי פרויקט** → **טאב "מסמכים"** → **כפתור "העלה מסמך"**
- גם בעמוד ריק: **"העלה מסמך ראשון"**

### שדות הטופס
| שדה | סוג | חובה | תיאור |
|-----|-----|------|--------|
| **סוג מסמך** | Dropdown | ✔️ | בחירה מרשימה: כתב התחייבות, מפרט, הסכם, דוח תכנון וכו' |
| **תאריך מסמך** | Date Picker | ✔️ | ברירת מחדל: היום |
| **קובץ להעלאה** | File Input | ✔️ | PDF, DOCX, Excel, תמונות (עד 10MB) |
| **הערות** | TextArea | ❌ | עד 500 תווים |

### תכונות מיוחדות
- ✅ **ולידציה מלאה** - בדיקת סוג קובץ, גודל, שדות חובה
- 🎨 **UI מתקדם** - drag & drop, תצוגה מקדימה של קבצים
- 📱 **Responsive** - מותאם לכל הגדלים
- 🌐 **RTL Support** - תמיכה מלאה בעברית

### API Endpoint
```http
POST /api/documents
Content-Type: multipart/form-data

{
  "tabar_number": "101",
  "type": "כתב התחייבות", 
  "date": "2024-06-19",
  "notes": "מסמך ראשוני",
  "file": [binary data]
}
```

---

## 📊 מודל דיווח ביצוע

### מיקום הכפתור
- **דף פרטי פרויקט** → **טאב "דיווחים"** → **כפתור "דווח חדש"**
- גם בעמוד ריק: **"הוסף דיווח ראשון"**

### שדות הטופס
| שדה | סוג | חובה | תיאור |
|-----|-----|------|--------|
| **תאריך דיווח** | Date Picker | ✔️ | תאריך ביצוע בפועל |
| **סכום שדווח** | Number Input | ✔️ | סכום בשקלים (חיובי בלבד) |
| **קובץ מצורף** | File Upload | ❌ | חשבונית, אישור תשלום |
| **הערות** | TextArea | ❌ | תיאור נוסף (עד 500 תווים) |

### תכונות מיוחדות
- 💰 **עיצוב כסף** - תצוגה מעוצבת של סכומים עם פסיקים
- 📈 **עדכון אוטומטי** - אחוז הניצול מתעדכן לאחר שמירה
- 📋 **סטטוס ברירת מחדל** - "ממתין לאישור"
- 🔢 **ולידציה מספרית** - רק מספרים חיוביים

### API Endpoint
```http
POST /api/reports/execution
Content-Type: multipart/form-data

{
  "tabar_number": "101",
  "report_date": "2024-06-01",
  "amount": 132000,
  "notes": "תשלום עבור שלב שלד",
  "file": [binary data]
}
```

---

## 🛠️ הטמעה טכנית

### Frontend Components
```
frontend/src/components/
├── AddDocumentModal.tsx      # מודל העלאת מסמכים
├── AddExecutionReportModal.tsx # מודל דיווח ביצוע
└── AddMilestoneModal.tsx     # מודל אבני דרך (קיים)
```

### Backend Controllers
```
backend/controllers/
├── documentsController.js    # ניהול מסמכים + העלאת קבצים
└── reportsController.js      # ניהול דיווחים + העלאת קבצים
```

### Database Tables
```sql
-- טבלת מסמכים
project_documents (
  id, tabar_number, type, name, 
  is_required, upload_date, file_url, 
  status, description
)

-- טבלת דיווחי ביצוע  
execution_reports (
  id, tabar_number, report_date, amount,
  status, notes, documents_attached, 
  created_by, file_url
)
```

---

## 🎨 עיצוב UI/UX

### עקרונות עיצוב
- **Material Design** - שימוש ב-shadcn/ui components
- **Hebrew First** - כל הטקסטים בעברית, RTL layout
- **Accessibility** - תמיכה מלאה בנגישות
- **Mobile Friendly** - מותאם למובייל

### צבעים ואייקונים
- 🔵 **כחול** - כפתורי מסמכים
- 🟢 **ירוק** - כפתורי דיווחים  
- 🔴 **אדום** - שגיאות וולידציה
- 📄 **אייקוני קבצים** - לפי סוג הקובץ

---

## ✅ בדיקות ואימות

### בדיקות שבוצעו
- [x] העלאת קבצים מסוגים שונים
- [x] ולידציה של שדות חובה
- [x] ולידציה של גודל קבצים (10MB)
- [x] ולידציה של סוגי קבצים מותרים
- [x] שמירה במסד הנתונים
- [x] תצוגה בטבלאות הפרויקט
- [x] עדכון מונים ואחוזי ניצול

### בדיקות נוספות מומלצות
- [ ] העלאת קבצים גדולים מ-10MB (צריך להיכשל)
- [ ] העלאת קבצים לא נתמכים (צריך להיכשל)
- [ ] דיווח סכומים שליליים (צריך להיכשל)
- [ ] בדיקת חיבור רשת איטי
- [ ] בדיקת תצוגה במובייל

---

## 🚀 הפעלה

### הפעלת השרת
```bash
# Backend
cd backend
node server.js

# Frontend  
cd frontend
npm run dev
```

### גישה למערכת
- **Frontend**: http://localhost:5173
- **Backend API**: http://localhost:3000
- **נתיב לפרויקט**: `/project/{tabar_number}`

---

## 🔧 פתרון בעיות

### בעיות נפוצות

**1. קובץ לא מתעלה**
- בדוק שגודל הקובץ מתחת ל-10MB
- בדוק שסוג הקובץ נתמך (PDF, DOC, XLS, תמונות)
- בדוק שיש מקום פנוי בשרת

**2. שגיאת 500 בשרת**
- בדוק שהטבלות קיימות במסד הנתונים
- בדוק שתיקיית uploads/ קיימת ויש הרשאות כתיבה
- בדוק את לוגי השרת

**3. המודל לא נפתח**
- בדוק שכל הייבואים נכונים ב-ProjectDetails.tsx
- בדוק שה-state מתעדכן כראוי
- בדוק את קונסולת הדפדפן לשגיאות

**4. הנתונים לא מתעדכנים**
- בדוק שה-API מחזיר תשובה תקינה
- בדוק שה-state מתרענן לאחר שמירה
- בדוק שהטבלאות מתעדכנות

---

## 📞 תמיכה

לקבלת עזרה נוספת או דיווח על באגים, אנא פנו למפתח המערכת.

**מיוחד**: המערכת תומכת בהעלאת מספר קבצים בו זמנית ובגרירה ושחרור (drag & drop) לחוויית משתמש משופרת! 🎉 